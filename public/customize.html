<!doctype html>
<html><head><meta charset="utf-8"><title>Customise - Toran Studio</title><link rel="stylesheet" href="/css/style.css"></head><body>
<nav class="topnav">
  <div class="logo"><a href="/">Toran Studio</a></div>
  <div class="links" id="navlinks">
    <a href="/">Home</a>
    <a href="/buy">Buy</a>
    <a href="/cart">Cart</a>
    <a id="adminlink" href="/admin" style="display:none">Settings</a>
    <a id="authlink" href="/auth/google">Sign in</a>
  </div>
</nav>

<main>
<h2 style="text-align:center">Request a Custom Toran</h2>
<form id="cform" enctype="multipart/form-data" style="max-width:600px;margin:0 auto">
<label>Your Gmail</label><input name="email" type="email" required>
<label>Message</label><textarea name="message" required></textarea>
<label>Photo (optional)</label><input name="image" type="file" accept="image/*">
<button type="submit" class="btn">Send Request</button>
</form>
<div id="status"></div>
</main>

<div id="profilePic"></div>

<script>
document.getElementById('cform').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const f = new FormData(e.target);
  document.getElementById('status').textContent='Sending...';
  const res = await fetch('/api/custom/create',{method:'POST', body: f});
  const j = await res.json();
  document.getElementById('status').textContent = j.ok ? 'Request sent!' : ('Error: '+(j.error||j.msg));
});

async function initNav(){
  try{
    const r = await fetch('/api/me'); const j = await r.json();
    const auth = document.getElementById('authlink');
    const admin = document.getElementById('adminlink');
    if(j.loggedIn){
      auth.textContent='Profile'; auth.href='/profile';
      if(j.user.role==='owner') admin.style.display='inline';
      const pp = document.getElementById('profilePic');
      if(j.user.photo) pp.innerHTML = `<a href="/profile"><img src="${j.user.photo}" alt="profile" class="pp"></a>`;
    } else { auth.textContent='Sign in'; auth.href='/auth/google'; }
  }catch(e){}
}
initNav();
</script>
</body></html>
