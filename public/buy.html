<!doctype html>
<html><head><meta charset="utf-8"><title>Buy - Toran Studio</title><link rel="stylesheet" href="/css/style.css"></head><body>
<nav class="topnav">
  <div class="logo"><a href="/">Toran Studio</a></div>
  <div class="links" id="navlinks">
    <a href="/">Home</a>
    <a href="/customize">Customise</a>
    <a href="/cart">Cart</a>
    <a id="adminlink" href="/admin" style="display:none">Settings</a>
    <a id="authlink" href="/auth/google">Sign in</a>
  </div>
</nav>

<main>
<h2 style="text-align:center">Products</h2>
<div id="products" class="products"></div>
</main>

<div id="profilePic"></div>

<script>
async function load(){
  const r = await fetch('/api/products'); const j = await r.json();
  const wrap = document.getElementById('products');
  j.products.forEach(p=>{
    const div = document.createElement('div'); div.className='product';
    div.innerHTML = `<img src="${p.image}"><h3>${p.name}</h3><p>${p.description}</p><div class="brand">Brand: ${p.brand}</div><div class="price">â‚¹${p.price}</div><button data-id="${p._id}" class="add">Add to cart</button>`;
    wrap.appendChild(div);
  });
  document.querySelectorAll('.add').forEach(b=>b.addEventListener('click', async (e)=>{
    const id = e.target.dataset.id;
    const r = await fetch('/api/cart/add',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({productId:id, qty:1})});
    const j = await r.json();
    alert(j.ok ? 'Added to cart' : 'Failed');
  }));
}
async function initNav(){
  try{
    const r = await fetch('/api/me'); const j = await r.json();
    const auth = document.getElementById('authlink');
    const admin = document.getElementById('adminlink');
    if(j.loggedIn){
      auth.textContent='Profile'; auth.href='/profile';
      if(j.user.role==='owner') admin.style.display='inline';
      const pp = document.getElementById('profilePic');
      if(j.user.photo) pp.innerHTML = `<a href="/profile"><img src="${j.user.photo}" alt="profile" class="pp"></a>`;
    } else { auth.textContent='Sign in'; auth.href='/auth/google'; }
  }catch(e){}
}
load(); initNav();
</script>
</body></html>
